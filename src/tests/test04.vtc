varnishtest "test rematch matchin on binary req.body"
server s1 {
        rxreq
        txresp -nolen -hdr "Transfer-encoding: chunked"
	chunked {BLAS}
	delay .2
	chunked {FOO}
	delay .2
	chunkedlen 0
} -start

# rematch_req_body is case sensitive.
varnish v1 -vcl+backend {
	import transbody from "${vmod_topbuild}/src/.libs/libvmod_transbody.so";
	import ${vmod_std};

	sub vcl_deliver {
	  	set resp.http.x-resplen = transbody.len_resp_body() ;
		set resp.http.x-respre = transbody.rematch_resp_body("BLA", 10000);
		set resp.http.x-respre2 = transbody.rematch_resp_body("AS", 10000);


	}

} -start


client c1 {
        txreq
        rxresp
	expect resp.bodylen == 7
	expect resp.http.x-resplen == 4
	expect resp.http.x-respre == 1
	expect resp.http.x-respre2 == 1

} -run
